<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Advanced OpenRefine | Introduction to OpenRefine</title>
  <meta name="description" content="Chapter 4 Advanced OpenRefine | Introduction to OpenRefine" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Advanced OpenRefine | Introduction to OpenRefine" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Advanced OpenRefine | Introduction to OpenRefine" />
  
  
  

<meta name="author" content="Ariel Deardorff, Data Services Librian, UCSF Library" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="basic-data-cleaning-with-openrefine.html"/>
<link rel="next" href="exporting-cleaned-data-and-scripts.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>



</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#pre-class-prep"><i class="fa fa-check"></i><b>1.1</b> Pre-Class Prep</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#learning-objectives"><i class="fa fa-check"></i><b>1.2</b> Learning Objectives</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#class-data"><i class="fa fa-check"></i><b>1.3</b> Class Data</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#about-the-instructor"><i class="fa fa-check"></i><b>1.4</b> About the Instructor</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="getting-to-know-our-data-and-tools.html"><a href="getting-to-know-our-data-and-tools.html"><i class="fa fa-check"></i><b>2</b> Getting to Know our Data and Tools</a><ul>
<li class="chapter" data-level="2.1" data-path="getting-to-know-our-data-and-tools.html"><a href="getting-to-know-our-data-and-tools.html#exploring-the-data"><i class="fa fa-check"></i><b>2.1</b> Exploring the Data</a></li>
<li class="chapter" data-level="2.2" data-path="getting-to-know-our-data-and-tools.html"><a href="getting-to-know-our-data-and-tools.html#what-is-open-refine"><i class="fa fa-check"></i><b>2.2</b> What is Open Refine?</a></li>
<li class="chapter" data-level="2.3" data-path="getting-to-know-our-data-and-tools.html"><a href="getting-to-know-our-data-and-tools.html#uploading-data-into-openrefine"><i class="fa fa-check"></i><b>2.3</b> Uploading Data Into OpenRefine</a></li>
<li class="chapter" data-level="2.4" data-path="getting-to-know-our-data-and-tools.html"><a href="getting-to-know-our-data-and-tools.html#the-openrefine-interface"><i class="fa fa-check"></i><b>2.4</b> The OpenRefine Interface</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="basic-data-cleaning-with-openrefine.html"><a href="basic-data-cleaning-with-openrefine.html"><i class="fa fa-check"></i><b>3</b> Basic Data Cleaning with OpenRefine</a><ul>
<li class="chapter" data-level="3.1" data-path="basic-data-cleaning-with-openrefine.html"><a href="basic-data-cleaning-with-openrefine.html#splitting-columns"><i class="fa fa-check"></i><b>3.1</b> Splitting Columns</a></li>
<li class="chapter" data-level="3.2" data-path="basic-data-cleaning-with-openrefine.html"><a href="basic-data-cleaning-with-openrefine.html#undoredo"><i class="fa fa-check"></i><b>3.2</b> Undo/Redo</a></li>
<li class="chapter" data-level="3.3" data-path="basic-data-cleaning-with-openrefine.html"><a href="basic-data-cleaning-with-openrefine.html#faceting-data"><i class="fa fa-check"></i><b>3.3</b> Faceting Data</a></li>
<li class="chapter" data-level="3.4" data-path="basic-data-cleaning-with-openrefine.html"><a href="basic-data-cleaning-with-openrefine.html#trimming-whitespace-and-changing-to-titlecase"><i class="fa fa-check"></i><b>3.4</b> Trimming Whitespace and Changing to Titlecase</a></li>
<li class="chapter" data-level="3.5" data-path="basic-data-cleaning-with-openrefine.html"><a href="basic-data-cleaning-with-openrefine.html#clustering-data"><i class="fa fa-check"></i><b>3.5</b> Clustering Data</a></li>
<li class="chapter" data-level="3.6" data-path="basic-data-cleaning-with-openrefine.html"><a href="basic-data-cleaning-with-openrefine.html#sorting"><i class="fa fa-check"></i><b>3.6</b> Sorting</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="advanced-openrefine.html"><a href="advanced-openrefine.html"><i class="fa fa-check"></i><b>4</b> Advanced OpenRefine</a><ul>
<li class="chapter" data-level="4.1" data-path="advanced-openrefine.html"><a href="advanced-openrefine.html#pulling-data-from-an-api"><i class="fa fa-check"></i><b>4.1</b> Pulling data from an API</a></li>
<li class="chapter" data-level="4.2" data-path="advanced-openrefine.html"><a href="advanced-openrefine.html#extracting-the-data"><i class="fa fa-check"></i><b>4.2</b> Extracting the Data</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="exporting-cleaned-data-and-scripts.html"><a href="exporting-cleaned-data-and-scripts.html"><i class="fa fa-check"></i><b>5</b> Exporting Cleaned Data and Scripts</a></li>
<li class="chapter" data-level="6" data-path="recommended-resources-and-tutorials.html"><a href="recommended-resources-and-tutorials.html"><i class="fa fa-check"></i><b>6</b> Recommended Resources and Tutorials</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to OpenRefine</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="advanced-openrefine" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Advanced OpenRefine</h1>
<p>In addition to the basic data cleaning features, OpenRefine has a variety of advanced features. Here we will go over how to pull in data from external sources and add it to our spreadsheet.</p>
<div id="pulling-data-from-an-api" class="section level2">
<h2><span class="header-section-number">4.1</span> Pulling data from an API</h2>
<p>Our current spreadsheet is missing some data about the tracking history of these products. Luckily, this data is available in the National Library of Medicine's Dietary Supplements Label Database and we can access it via an application programming interface (API). To learn more about this particular database and API you can visit <a href="https://datadiscovery.nlm.nih.gov/Drugs-and-Supplements/Dietary-Supplements-Label-Database-DSLD-Product-In/wp6t-qxsk">the website</a>.</p>
<ul>
<li>Before we add a bunch of new data, letâ€™s test our script on a couple of records. Go ahead and star five records using the little star icon on the far left of each record.
<ul>
<li>Then, under <code>All</code> &gt; <code>Facet</code> &gt; <code>Facet by star</code> and select <code>TRUE</code> in the facet box on the left.</li>
</ul></li>
<li>Now we want to pull new data from the database using the <code>DSLD ID</code> number. Under the <code>DSLD ID</code> column select &gt; <code>Edit column</code> &gt; <code>Add column by fetching URLs</code>
<ul>
<li>In the box enter: <code>&quot;https://datadiscovery.nlm.nih.gov/resource/wp6t-qxsk.json?dsld_id=&quot;+value</code> this is the URL of the API plus a stand-in for the ID number (the <code>+value</code>). You should see a preview of the URL with the ID at the end.</li>
</ul></li>
<li>Name the new column <code>JSON</code> and hit <code>OK</code>. It might take a minute or so to load but eventually we should get a paragraph of text in JSON format.</li>
</ul>
</div>
<div id="extracting-the-data" class="section level2">
<h2><span class="header-section-number">4.2</span> Extracting the Data</h2>
<ul>
<li>JSON, or JavaScript Object Notation is a text format for storing and sharing data, often in lists or dictionaries. We basically asked the NLM database to send us all the info they have for this ID. Now we need to extract the info we want and put it in a new column</li>
<li>Under the <code>JSON</code> column select <code>Edit column</code> &gt; <code>Add column based on this column</code>
<ul>
<li>In the box write: <code>value.parseJson()[0][&quot;tracking_history&quot;]</code>. This is a GREL (google refine experssion language) expression that tells OpenRefine to parse the JSON by pulling the first list of items [0] and then pulling the data that corresponds with the Tracking history segment. When you are done name this column <code>Tracking History</code> and hit <code>OK</code>. You can learn more about parsing JSON in this other library class: <a href="https://courses.ucsf.edu/course/view.php?id=5247">Reading Data from an API with Python and JSON</a>.</li>
</ul></li>
<li>There are a ton of ways to add more info to OpenRefine. In addition to adding new data you can also reconcile the data you have by pulling in official lists of names/businesses/authors from a site like Wikidata (more info in the resources section at the end).</li>
<li><strong>Challenge</strong>: add a new column containing the <code>database</code> info from the JSON. Hint: look at the <code>History</code> tab in your GREL workspace to see your previous commands.</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="basic-data-cleaning-with-openrefine.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exporting-cleaned-data-and-scripts.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
