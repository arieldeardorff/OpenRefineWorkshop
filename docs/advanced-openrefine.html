<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Advanced OpenRefine | Introduction to OpenRefine</title>
  <meta name="description" content="Chapter 4 Advanced OpenRefine | Introduction to OpenRefine" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Advanced OpenRefine | Introduction to OpenRefine" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Advanced OpenRefine | Introduction to OpenRefine" />
  
  
  

<meta name="author" content="Ariel Deardorff, Data Services Librarian, UCSF Library" />


<meta name="date" content="2023-02-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="basic-data-cleaning-with-openrefine.html"/>
<link rel="next" href="exporting-cleaned-data-and-scripts.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>




</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="index.html#welcome" id="toc-welcome"><span class="toc-section-number">1</span> Welcome</a>
<ul>
<li><a href="index.html#pre-class-prep" id="toc-pre-class-prep"><span class="toc-section-number">1.1</span> Pre-Class Prep</a></li>
<li><a href="index.html#learning-objectives" id="toc-learning-objectives"><span class="toc-section-number">1.2</span> Learning Objectives</a></li>
<li><a href="index.html#class-data" id="toc-class-data"><span class="toc-section-number">1.3</span> Class Data</a></li>
<li><a href="index.html#about-the-instructor" id="toc-about-the-instructor"><span class="toc-section-number">1.4</span> About the Instructor</a></li>
</ul></li>
<li><a href="getting-to-know-our-data-and-tools.html#getting-to-know-our-data-and-tools" id="toc-getting-to-know-our-data-and-tools"><span class="toc-section-number">2</span> Getting to Know our Data and Tools</a>
<ul>
<li><a href="getting-to-know-our-data-and-tools.html#what-is-openrefine" id="toc-what-is-openrefine"><span class="toc-section-number">2.1</span> What is OpenRefine?</a></li>
<li><a href="getting-to-know-our-data-and-tools.html#exploring-the-data" id="toc-exploring-the-data"><span class="toc-section-number">2.2</span> Exploring the Data</a></li>
<li><a href="getting-to-know-our-data-and-tools.html#uploading-data-into-openrefine" id="toc-uploading-data-into-openrefine"><span class="toc-section-number">2.3</span> Uploading Data Into OpenRefine</a></li>
<li><a href="getting-to-know-our-data-and-tools.html#the-openrefine-interface" id="toc-the-openrefine-interface"><span class="toc-section-number">2.4</span> The OpenRefine Interface</a></li>
</ul></li>
<li><a href="basic-data-cleaning-with-openrefine.html#basic-data-cleaning-with-openrefine" id="toc-basic-data-cleaning-with-openrefine"><span class="toc-section-number">3</span> Basic Data Cleaning with OpenRefine</a>
<ul>
<li><a href="basic-data-cleaning-with-openrefine.html#splitting-columns" id="toc-splitting-columns"><span class="toc-section-number">3.1</span> Splitting Columns</a></li>
<li><a href="basic-data-cleaning-with-openrefine.html#undoredo" id="toc-undoredo"><span class="toc-section-number">3.2</span> Undo/Redo</a></li>
<li><a href="basic-data-cleaning-with-openrefine.html#faceting-data" id="toc-faceting-data"><span class="toc-section-number">3.3</span> Faceting Data</a></li>
<li><a href="basic-data-cleaning-with-openrefine.html#trimming-whitespace-and-changing-to-titlecase" id="toc-trimming-whitespace-and-changing-to-titlecase"><span class="toc-section-number">3.4</span> Trimming Whitespace and Changing to Titlecase</a></li>
<li><a href="basic-data-cleaning-with-openrefine.html#clustering-data" id="toc-clustering-data"><span class="toc-section-number">3.5</span> Clustering Data</a></li>
<li><a href="basic-data-cleaning-with-openrefine.html#sorting" id="toc-sorting"><span class="toc-section-number">3.6</span> Sorting</a></li>
</ul></li>
<li><a href="advanced-openrefine.html#advanced-openrefine" id="toc-advanced-openrefine"><span class="toc-section-number">4</span> Advanced OpenRefine</a>
<ul>
<li><a href="advanced-openrefine.html#pulling-data-from-an-api" id="toc-pulling-data-from-an-api"><span class="toc-section-number">4.1</span> Pulling data from an API</a></li>
<li><a href="advanced-openrefine.html#extracting-the-data" id="toc-extracting-the-data"><span class="toc-section-number">4.2</span> Extracting the Data</a></li>
</ul></li>
<li><a href="exporting-cleaned-data-and-scripts.html#exporting-cleaned-data-and-scripts" id="toc-exporting-cleaned-data-and-scripts"><span class="toc-section-number">5</span> Exporting Cleaned Data and Scripts</a></li>
<li><a href="recommended-resources-and-tutorials.html#recommended-resources-and-tutorials" id="toc-recommended-resources-and-tutorials"><span class="toc-section-number">6</span> Recommended Resources and Tutorials</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to OpenRefine</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="advanced-openrefine" class="section level1" number="4">
<h1><span class="header-section-number">Chapter 4</span> Advanced OpenRefine</h1>
<p>In addition to the basic data cleaning features, OpenRefine has a variety of advanced features. Here we will go over how to pull in data from external sources and add it to our spreadsheet. To learn more about other advanced features, check out the <a href="https://arieldeardorff.github.io/OpenRefineWorkshop/recommended-resources-and-tutorials.html">Recommended Resources page</a>.</p>
<div id="pulling-data-from-an-api" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Pulling data from an API</h2>
<p>Our current spreadsheet is missing some data about the tracking history of these products. Luckily, this data is available in the National Library of Medicine’s Dietary Supplements Label Database and we can access it via an application programming interface (API). To learn more about this particular database and API you can visit <a href="https://datadiscovery.nlm.nih.gov/Drugs-and-Supplements/Dietary-Supplements-Label-Database-DSLD-Product-In/wp6t-qxsk">the website</a>.</p>
<ul>
<li>Before we add a bunch of new data, let’s test our script on a couple of records. Go ahead and star two records using the little star icon on the far left of each record.
<ul>
<li>Then, under <code>All</code> &gt; <code>Facet</code> &gt; <code>Facet by star</code> and select <code>TRUE</code> in the facet box on the left. Now we can work with these two records.</li>
</ul></li>
<li>Now we want to pull new data from the database using the <code>DSLD ID</code> number. Under the <code>DSLD ID</code> column select &gt; <code>Edit column</code> &gt; <code>Add column by fetching URLs</code>
<ul>
<li>In the box enter: <code>"https://api.ods.od.nih.gov/dsld/v9/label/"+value</code> this is the URL of the API plus a stand-in for the ID number (the <code>+value</code>). You should see a preview of the URL with the ID at the end.</li>
</ul></li>
</ul>
<p><img src="images/OpenRefine_API.png" /></p>
<ul>
<li>Name the new column <code>JSON</code> and hit <code>OK</code>. It might take a minute or so to load but eventually we should get a new column called <code>JSON</code> with a (huge) paragraph of text in JSON format.</li>
</ul>
</div>
<div id="extracting-the-data" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Extracting the Data</h2>
<ul>
<li>JSON, or JavaScript Object Notation is a text format for storing and sharing data, often in lists or dictionaries. We basically asked the NLM database to send us all the info they have for this ID. Now we need to extract the info we want and put it in a new column</li>
<li>Under the <code>JSON</code> column select <code>Edit column</code> &gt; <code>Add column based on this column</code>
<ul>
<li>In the box write: <code>value.parseJson().servingsPerContainer</code>. This is a GREL (google refine experssion language) command that tells OpenRefine to extract the relevant bit of the JSON data by pulling the data that corresponds with the <code>servingsPerContainer</code> segment. When you are done name this column <code>Servings Per Container</code> and hit <code>OK</code>. Now we should have a new column called “Servings Per Container” with the relevant info from the JSON text.</li>
</ul></li>
<li>You can learn more about parsing JSON in this UCSF library class: <a href="https://courses.ucsf.edu/course/view.php?id=5247">Reading Data from an API with Python and JSON</a>.</li>
</ul>
<p><img src="images/OpenRefine_ParseJSON.png" /></p>
<p><img src="images/OpenRefine_FinalResult.png" /></p>
<ul>
<li>There are a ton of ways to add more info to OpenRefine. In addition to adding new data you can also reconcile the data you have by pulling in official lists of names/businesses/authors from a site like Wikidata (more info in the resources section at the end).</li>
<li><strong>Challenge</strong>: add a new column containing the <code>upcSku</code> info from the JSON. Hint: look at the <code>History</code> tab in your GREL workspace to see your previous commands.</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="basic-data-cleaning-with-openrefine.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exporting-cleaned-data-and-scripts.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
